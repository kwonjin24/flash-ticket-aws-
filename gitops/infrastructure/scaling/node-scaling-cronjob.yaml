# NodePool í™œì„±í™” CronJob (ì˜¤í›„ 4:45)
apiVersion: batch/v1
kind: CronJob
metadata:
  name: nodepool-activate
  namespace: flash-ticket
spec:
  schedule: "8 17 * * *"  # ë§¤ì¼ ì˜¤í›„ 5:08 (íŒŒë“œ ìŠ¤ì¼€ì¼ì—… 2ë¶„ ì „)
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: scaling-operator
          containers:
          - name: kubectl
            image: bitnami/kubectl:latest
            command:
            - /bin/sh
            - -c
            - |
              echo "âš¡ Peak-time NodePool í™œì„±í™” ì‹œì‘..."
              
              # NodePool ìƒì„±
              kubectl apply -f - <<EOF
              apiVersion: karpenter.sh/v1beta1
              kind: NodePool
              metadata:
                name: peak-time
                labels:
                  usage: peak-traffic
              spec:
                template:
                  spec:
                    requirements:
                      - key: kubernetes.io/arch
                        operator: In
                        values: ["amd64"]
                      - key: kubernetes.io/os
                        operator: In
                        values: ["linux"]
                      - key: karpenter.sh/capacity-type
                        operator: In
                        values: ["spot", "on-demand"]
                      - key: node.kubernetes.io/instance-type
                        operator: In
                        values: ["t3.medium", "t3.large", "c5.large"]
                      - key: topology.kubernetes.io/zone
                        operator: In
                        values: ["ap-northeast-2a", "ap-northeast-2b", "ap-northeast-2c"]
                    nodeClassRef:
                      name: default
                limits:
                  cpu: 2000
                disruption:
                  consolidationPolicy: WhenEmpty
                  consolidateAfter: 30m
                  expireAfter: 60m
              EOF
              
              # ê²°ê³¼ í™•ì¸
              echo "=== NodePool ìƒíƒœ ==="
              kubectl get nodepools
              
              echo "âœ… Peak-time NodePool í™œì„±í™” ì™„ë£Œ!"
          restartPolicy: OnFailure
---
# NodePool ë¹„í™œì„±í™” CronJob (ì˜¤í›„ 5:45)
apiVersion: batch/v1
kind: CronJob
metadata:
  name: nodepool-deactivate
  namespace: flash-ticket
spec:
  schedule: "15 17 * * *"  # ë§¤ì¼ ì˜¤í›„ 5:15 (íŒŒë“œ ìŠ¤ì¼€ì¼ë‹¤ìš´ 5ë¶„ í›„)
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: scaling-operator
          containers:
          - name: kubectl
            image: bitnami/kubectl:latest
            command:
            - /bin/sh
            - -c
            - |
              echo "ğŸ”½ Peak-time NodePool ë¹„í™œì„±í™” ì‹œì‘..."
              
              # NodePool ì‚­ì œ
              kubectl delete nodepool peak-time --ignore-not-found=true
              
              # ê²°ê³¼ í™•ì¸
              echo "=== NodePool ìƒíƒœ ==="
              kubectl get nodepools
              
              echo "âœ… Peak-time NodePool ë¹„í™œì„±í™” ì™„ë£Œ!"
          restartPolicy: OnFailure