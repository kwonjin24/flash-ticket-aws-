# 부하 테스트 계획서

Flash Tickets 시스템의 전체 부하 테스트 계획 및 실행 전략입니다.

## 목차

1. [테스트 목표](#테스트-목표)
2. [테스트 범위](#테스트-범위)
3. [테스트 전략](#테스트-전략)
4. [성능 목표](#성능-목표)
5. [테스트 일정](#테스트-일정)
6. [리스크 관리](#리스크-관리)
7. [역할 및 책임](#역할-및-책임)

---

## 테스트 목표

### 주요 목표

1. **대기열 시스템 검증**
   - 동시 접속자 처리 능력 측정
   - Redis 기반 대기열 성능 검증
   - 순번 관리 정확성 확인

2. **시스템 한계치 파악**
   - 최대 TPS (Transactions Per Second) 측정
   - 병목 구간 식별
   - 시스템 임계점 확인

3. **Auto Scaling 검증**
   - Karpenter 동작 확인
   - HPA (Horizontal Pod Autoscaler) 검증
   - 스케일 아웃/인 응답 시간 측정

4. **안정성 검증**
   - 장시간 운영 안정성
   - 메모리 누수 확인
   - 에러 복구 능력

---

## 테스트 범위

### 포함 항목

#### 1. 기능 테스트
- ✅ 사용자 인증 (회원가입/로그인)
- ✅ 이벤트 조회
- ✅ 대기열 등록
- ✅ 대기열 상태 확인
- ✅ 주문 생성
- ✅ 결제 처리

#### 2. 성능 테스트
- ✅ 응답 시간
- ✅ 처리량 (TPS)
- ✅ 동시 접속자 처리
- ✅ 리소스 사용률

#### 3. 스케일링 테스트
- ✅ Pod Auto Scaling (HPA)
- ✅ Node Auto Scaling (Karpenter)
- ✅ 스케일 아웃 속도
- ✅ 스케일 인 동작

#### 4. 안정성 테스트
- ✅ 장시간 운영 (1시간)
- ✅ 트래픽 급증 대응
- ✅ 에러 복구
- ✅ 재시도 로직

### 제외 항목

- ❌ 프론트엔드 UI 테스트
- ❌ 보안 침투 테스트
- ❌ 데이터 마이그레이션
- ❌ 백업/복구 테스트

---

## 테스트 전략

### 1. Smoke Test (기본 검증)

**목적**: 모든 API가 정상 동작하는지 확인

**설정**:
```
사용자 수: 10명
Ramp-up: 10초
기간: 1분
```

**검증 항목**:
- [ ] 모든 엔드포인트 200 OK 응답
- [ ] 평균 응답 시간 < 1초
- [ ] 에러율 0%

**실행 시점**: 매 배포 후

---

### 2. Load Test (부하 테스트)

**목적**: 일반적인 트래픽에서의 성능 확인

**설정**:
```
사용자 수: 100 → 500명 (단계적 증가)
Ramp-up: 5분
기간: 10분
```

**시나리오**:
```
1. 로그인 (1회)
2. 이벤트 목록 조회 (3회)
3. 대기열 등록 (1회)
4. 대기열 상태 확인 (10회, 5초 간격)
5. 입장 (1회)
6. 주문 생성 (1회)
```

**검증 항목**:
- [ ] 평균 응답 시간 < 500ms
- [ ] 95 percentile < 1초
- [ ] 에러율 < 1%
- [ ] TPS > 100

**모니터링**:
- CPU 사용률 < 70%
- Memory 사용률 < 70%
- Redis 연결 수
- Database 커넥션 풀

---

### 3. Stress Test (스트레스 테스트)

**목적**: 시스템 한계 확인

**설정**:
```
사용자 수: 1000 → 5000명 (단계적 증가)
Ramp-up: 10분
기간: 20분
```

**단계별 증가**:
```
0-5분:   1000 users
5-10분:  2000 users
10-15분: 3500 users
15-20분: 5000 users
```

**검증 항목**:
- [ ] 시스템이 완전히 멈추지 않음
- [ ] 병목 구간 식별
- [ ] 임계점 (Breaking Point) 확인
- [ ] 최대 TPS 측정

**예상 병목**:
- Redis 연결 수 제한
- Database 쿼리 성능
- API Rate Limiting
- 네트워크 대역폭

---

### 4. Spike Test (급증 테스트)

**목적**: 갑작스런 트래픽 급증 대응 확인

**설정**:
```
단계 1: 10명 (2분)
단계 2: 1000명으로 급증 (10초)
단계 3: 1000명 유지 (10분)
단계 4: 10명으로 감소 (10초)
단계 5: 10명 유지 (2분)
```

**검증 항목**:
- [ ] Auto Scaling 동작 확인
- [ ] 급증 시 에러율 < 5%
- [ ] 복구 시간 < 2분
- [ ] Karpenter 노드 추가 시간

**예상 이슈**:
- Pod 스케일 아웃 지연
- Connection Pool 고갈
- Rate Limiting 발동

---

### 5. Endurance Test (지속성 테스트)

**목적**: 장시간 운영 시 메모리 누수 등 확인

**설정**:
```
사용자 수: 200명 (일정)
기간: 1시간
```

**검증 항목**:
- [ ] 메모리 사용량이 일정 수준 유지
- [ ] 응답 시간 증가 없음
- [ ] Connection Leak 없음
- [ ] 에러율 변화 없음

**모니터링 간격**: 1분

---

## 성능 목표

### 응답 시간 (Response Time)

| 엔드포인트 | 평균 | 95 percentile | 99 percentile |
|-----------|------|---------------|---------------|
| POST /auth/login | < 200ms | < 500ms | < 1000ms |
| GET /events | < 100ms | < 300ms | < 500ms |
| POST /queue/enqueue | < 300ms | < 800ms | < 1500ms |
| GET /queue/status | < 100ms | < 300ms | < 500ms |
| POST /queue/enter | < 200ms | < 500ms | < 1000ms |
| POST /orders | < 500ms | < 1500ms | < 3000ms |

### 처리량 (Throughput)

| 시나리오 | 목표 TPS | 최소 TPS |
|---------|---------|----------|
| 이벤트 조회 | 500 | 300 |
| 대기열 등록 | 100 | 50 |
| 대기열 상태 확인 | 1000 | 500 |
| 주문 생성 | 50 | 30 |

### 에러율 (Error Rate)

| 부하 수준 | 목표 | 허용 |
|----------|------|------|
| 정상 부하 | 0% | < 0.1% |
| 높은 부하 | < 1% | < 3% |
| 극한 부하 | < 5% | < 10% |

### 리소스 사용률

| 리소스 | 정상 | 경고 | 위험 |
|--------|------|------|------|
| CPU | < 50% | 50-70% | > 70% |
| Memory | < 60% | 60-80% | > 80% |
| Network | < 50% | 50-70% | > 70% |
| Disk I/O | < 60% | 60-80% | > 80% |

---

## 테스트 일정

### Week 1: 준비 단계

**Day 1-2**: 환경 구성
- [x] JMeter 설치
- [ ] 테스트 계정 생성
- [ ] 네트워크 설정 확인
- [ ] 모니터링 대시보드 설정

**Day 3-4**: Smoke Test
- [ ] 기본 시나리오 작성
- [ ] Smoke Test 실행
- [ ] 이슈 수정

**Day 5**: 검토 및 조정

---

### Week 2: 부하 테스트

**Day 1-2**: Load Test
- [ ] Load Test 시나리오 작성
- [ ] 100 users 테스트
- [ ] 500 users 테스트
- [ ] 결과 분석 및 최적화

**Day 3-4**: Stress Test
- [ ] Stress Test 시나리오 작성
- [ ] 1000 users 테스트
- [ ] 3000 users 테스트
- [ ] 5000 users 테스트
- [ ] 병목 구간 식별

**Day 5**: 중간 리뷰

---

### Week 3: 고급 테스트

**Day 1-2**: Spike Test
- [ ] Spike Test 시나리오 작성
- [ ] Auto Scaling 검증
- [ ] 복구 시나리오 테스트

**Day 3-4**: Endurance Test
- [ ] Endurance Test 실행 (1시간)
- [ ] 메모리 누수 확인
- [ ] 장시간 안정성 검증

**Day 5**: 최종 보고서 작성

---

## 리스크 관리

### 주요 리스크

| 리스크 | 발생 가능성 | 영향도 | 완화 전략 |
|--------|------------|--------|----------|
| 프로덕션 환경 영향 | 중 | 높음 | 별도 테스트 환경 사용 |
| 테스트 데이터 부족 | 중 | 중 | 사전 데이터 준비 |
| 네트워크 대역폭 부족 | 낮 | 중 | 대역폭 모니터링 |
| 외부 의존성 실패 | 중 | 높음 | Mock 서버 준비 |
| 비용 초과 | 낮 | 중 | 예산 모니터링 |

### 비상 계획

**테스트 중단 조건**:
1. 프로덕션 환경에 영향
2. 복구 불가능한 데이터 손실
3. 보안 이슈 발견
4. 인프라 비용 급증

**중단 시 조치**:
1. 즉시 테스트 중단
2. 영향 범위 파악
3. 복구 조치 실행
4. 사후 분석

---

## 역할 및 책임

### 테스트 팀

| 역할 | 책임 | 담당자 |
|-----|------|--------|
| Test Lead | 전체 테스트 계획 및 조율 | - |
| Test Engineer | 시나리오 작성 및 실행 | - |
| DevOps Engineer | 인프라 모니터링 및 조정 | - |
| Backend Developer | 이슈 분석 및 최적화 | - |

### 의사소통 계획

**Daily Standup**: 매일 오전 10시
- 진행 상황 공유
- 이슈 논의
- 당일 계획

**Weekly Review**: 매주 금요일 오후 3시
- 주간 결과 리뷰
- 다음 주 계획
- 리스크 검토

**Communication Channels**:
- Slack: #load-testing
- 이슈 트래킹: Jira/GitHub Issues
- 문서: Confluence/Notion

---

## 테스트 체크리스트

### 사전 준비

- [ ] JMeter 설치 및 설정 완료
- [ ] 테스트 환경 구성 완료
- [ ] 모니터링 대시보드 설정
- [ ] 테스트 계정 생성
- [ ] 베이스라인 데이터 수집
- [ ] 이해관계자 승인

### 테스트 실행

- [ ] 테스트 시작 전 시스템 상태 확인
- [ ] 모니터링 도구 실행
- [ ] 테스트 시나리오 실행
- [ ] 실시간 모니터링
- [ ] 이슈 발생 시 기록

### 사후 작업

- [ ] 결과 데이터 백업
- [ ] 성능 메트릭 분석
- [ ] 병목 구간 식별
- [ ] 개선 사항 도출
- [ ] 보고서 작성
- [ ] 후속 조치 계획

---

## 다음 단계

1. [시나리오별 상세 가이드](scenarios/) 검토
2. 테스트 환경 설정
3. Smoke Test 실행
4. 단계별 부하 테스트 진행
5. 결과 분석 및 최적화

## 참고 문서

- [API 엔드포인트 목록](endpoints.md)
- [JMeter 설정 가이드](jmeter-setup.md)
- [시나리오별 가이드](scenarios/)
