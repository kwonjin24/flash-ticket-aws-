# íŒŒë“œ ìŠ¤ì¼€ì¼ì—… CronJob (ì˜¤í›„ 4:50)
apiVersion: batch/v1
kind: CronJob
metadata:
  name: pod-scale-up
  namespace: flash-ticket
spec:
  schedule: "22 13 * * *"  # UTC 13:22 (KST 22:22, NodePool ìƒì„± 2ë¶„ í›„)
  suspend: true  # í…ŒìŠ¤íŠ¸ ë¹„í™œì„±í™”
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: scaling-operator
          containers:
          - name: kubectl
            image: bitnami/kubectl:latest
            command:
            - /bin/sh
            - -c
            - |
              echo "ğŸš€ íŒŒë“œ ìŠ¤ì¼€ì¼ì—… ì‹œì‘..."
              
              # í˜„ì¬ HPA ìƒíƒœ í™•ì¸
              echo "=== ìŠ¤ì¼€ì¼ì—… ì „ HPA ìƒíƒœ ==="
              kubectl get hpa -n flash-ticket
              
              # HPA minReplicas ì¦ê°€ë¡œ ê°•ì œ ìŠ¤ì¼€ì¼ì—…
              echo "=== HPA í”¼í¬ ëª¨ë“œ í™œì„±í™” ==="
              kubectl patch hpa flash-api-hpa -n flash-ticket -p '{"spec":{"minReplicas":6}}'
              kubectl patch hpa flash-gateway-hpa -n flash-ticket -p '{"spec":{"minReplicas":6}}'
              kubectl patch hpa flash-pay-hpa -n flash-ticket -p '{"spec":{"minReplicas":6}}'
              
              # ê²°ê³¼ í™•ì¸
              echo "=== ìŠ¤ì¼€ì¼ì—… í›„ ìƒíƒœ ==="
              kubectl get hpa -n flash-ticket
              kubectl get deployments -n flash-ticket
              
              echo "âœ… íŒŒë“œ ìŠ¤ì¼€ì¼ì—… ì™„ë£Œ!"
          restartPolicy: OnFailure
---
# íŒŒë“œ ìŠ¤ì¼€ì¼ë‹¤ìš´ CronJob (ì˜¤í›„ 5:30)
apiVersion: batch/v1
kind: CronJob
metadata:
  name: pod-scale-down
  namespace: flash-ticket
spec:
  schedule: "24 13 * * *"  # UTC 13:24 (KST 22:24, 2ë¶„ í›„ ìŠ¤ì¼€ì¼ë‹¤ìš´)
  suspend: true  # í…ŒìŠ¤íŠ¸ ë¹„í™œì„±í™”
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: scaling-operator
          containers:
          - name: kubectl
            image: bitnami/kubectl:latest
            command:
            - /bin/sh
            - -c
            - |
              echo "ğŸ“‰ íŒŒë“œ ìŠ¤ì¼€ì¼ë‹¤ìš´ ì‹œì‘..."
              
              # í˜„ì¬ HPA ìƒíƒœ í™•ì¸
              echo "=== ìŠ¤ì¼€ì¼ë‹¤ìš´ ì „ HPA ìƒíƒœ ==="
              kubectl get hpa -n flash-ticket
              
              # HPA minReplicas ì›ë³µìœ¼ë¡œ ìë™ ìŠ¤ì¼€ì¼ë‹¤ìš´
              echo "=== HPA ì¼ë°˜ ëª¨ë“œ ë³µì› ==="
              kubectl patch hpa flash-api-hpa -n flash-ticket -p '{"spec":{"minReplicas":2}}'
              kubectl patch hpa flash-gateway-hpa -n flash-ticket -p '{"spec":{"minReplicas":2}}'
              kubectl patch hpa flash-pay-hpa -n flash-ticket -p '{"spec":{"minReplicas":1}}'
              
              # ê²°ê³¼ í™•ì¸
              echo "=== ìŠ¤ì¼€ì¼ë‹¤ìš´ í›„ ìƒíƒœ ==="
              kubectl get hpa -n flash-ticket
              kubectl get deployments -n flash-ticket
              
              echo "âœ… íŒŒë“œ ìŠ¤ì¼€ì¼ë‹¤ìš´ ì™„ë£Œ!"
          restartPolicy: OnFailure